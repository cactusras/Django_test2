<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>點擊編輯班表</title>
    
    <link rel="icon" type="image/x-icon" href="{% static 'myApp/assets/favicon.ico' %}" /> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" /> 
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" /> 

    <!-- <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" /> -->

</head>

<body>
    <!--網頁頭-->
    <nav class="navbar navbar-expand-lg" style="background-color:#F0EAD6; height: 100px;">
        <div class="container px-4 px-lg-5">
            <img src="{% static 'assets/dental.png' %}" alt="DEN Logo">
            <a class="navbar-brand" href="#!" style="font-size: 24px;">牙醫預約平台</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <div class="ms-auto">
                    <button class="btn btn-outline-dark" type="submit" style="font-size: 20px;">
                        <i class="bi bi-person-fill"></i>
                        登入
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <section class="py-5" style="background-color:#FFFFF4">
        <div class="container" style="border: 1px solid #F0EAD6;">
            <div class="row row-cols-1">
                <div class="col d-flex align-items-center justify-content-center" style="background-color:#F0EAD6; border: 1px solid #ada089; height:80px; font-size: 20px;">
                    編輯班表
                </div>
                <div class="col" style="background-color:#fffff0; border: 1px solid #ada089; height:600px; font-size: 20px;">
                    <div class="container">
                        <div style="border: 20px solid #fffff0; ">
                            <!--選擇天數-->
                            開始：
                            <input type="date"  min="2024-05-20"  required />
                            結束：
                            <input type="date"  min="2024-05-20"  required />
                        </div>

                        <table class="table table-bordered" style="border: 1px solid #ada089;">
                            <thead>
                                <tr>
                                    <th scope="col"><i class="bi bi-clock-fill"></i></th>
                                    <th scope="col">週一</th>
                                    <th scope="col">週二</th>
                                    <th scope="col">週三</th>
                                    <th scope="col">週四</th>
                                    <th scope="col">週五</th>
                                    <th scope="col">週六</th>
                                    <th scope="col">週日</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="col"><p>10:00<br>-<br>14:00<br></p></th>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                </tr>
                                <tr>
                                    <th scope="col"><p>15:00<br>-<br>18:00<br></p></th>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                </tr>
                                <tr>
                                    <th scope="col"><p>19:00<br>-<br>21:00<br></p></th>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                    <td contenteditable="true"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="text-align: right; margin-right: 10px;">
                        <button class="btn btn-outline-dark" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="font-size: 20px; width: 160px; height: 40px;">
                            <i class="bi bi-calendar2-plus-fill"></i>
                            時段
                        </button>
                        <!--時段按鈕的彈跳視窗-->
                        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="staticBackdropLabel">編輯時段</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <select class="form-select" id="daySelect" aria-label="Default select example">
                                            <option selected>選擇星期</option>
                                            <option value="1">週一</option>
                                            <option value="2">週二</option>
                                            <option value="3">週三</option>
                                            <option value="4">週四</option>
                                            <option value="5">週五</option>
                                            <option value="6">週六</option>
                                            <option value="7">週日</option>
                                        </select>
                                        <br>
                        
                                        <form id="timeForm" style="text-align: left;">
                                            <label for="startTime">開始：</label>
                                            <input type="time" id="startTime" min="10:00" max="21:00" step="3600" />
                                            <label for="endTime">結束：</label>
                                            <input type="time" id="endTime" min="10:00" max="21:00" step="3600" />
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">刪除</button>
                                        <button type="button" class="btn btn-primary" id="addTimeSlot">新增</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline-dark" type="submit" style="font-size: 20px; width: 160px; height: 40px;">
                            <i class="bi bi-calendar-check-fill"></i>
                            完成
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--頁面底-->
    <footer class="py-5 bg-dark">
        <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
    </footer>
   <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="{% static 'js/scripts.js' %}"></script>

    <!-- Custom JS to handle adding time slots -->
    <script>
        // Function to set minutes to 00
        function adjustTimeToHour(input) {
            const timeValue = input.value;
            if (timeValue) {
                const [hour,] = timeValue.split(':');
                input.value = `${hour}:00`;
            }
        }

        // Listen for changes on time inputs
        document.getElementById('startTime').addEventListener('change', function() {
            adjustTimeToHour(this);
        });

        document.getElementById('endTime').addEventListener('change', function() {
            adjustTimeToHour(this);
        });

        document.getElementById('addTimeSlot').addEventListener('click', function () {
            const daySelect = document.getElementById('daySelect');
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const selectedDay = daySelect.value;

            // Validate the times
            if (startTime && endTime && endTime > startTime) {
                // Check if the time range fits within any of the allowed intervals
                const validIntervals = [
                    {start: '10:00', end: '14:00'},
                    {start: '15:00', end: '18:00'},
                    {start: '19:00', end: '21:00'}
                ];
                const isValid = validIntervals.some(interval => startTime >= interval.start && endTime <= interval.end);

                if (isValid) {
                    // Get the table and the row based on the selected times
                    const table = document.querySelector('table tbody');
                    let row;
                    if (startTime >= '10:00' && endTime <= '14:00') {
                        row = table.rows[0];
                    } else if (startTime >= '15:00' && endTime <= '18:00') {
                        row = table.rows[1];
                    } else if (startTime >= '19:00' && endTime <= '21:00') {
                        row = table.rows[2];
                    }

                    if (row) {
                        const cell = row.cells[selectedDay];
                        cell.textContent = `${startTime} - ${endTime}`;
                    }

                    // Close the modal
                    const modal = document.getElementById('staticBackdrop');
                    const modalInstance = bootstrap.Modal.getInstance(modal);
                    modalInstance.hide();
                } else {
                    alert('選擇的時間範圍無效。請選擇以下區間段之一：10:00-14:00，15:00-18:00，19:00-21:00。');
                }
            } else {
                alert('請選擇正確的開始和結束時間。結束時間必須晚於開始時間。');
            }
        });
    </script>
</body>                        
</html>

