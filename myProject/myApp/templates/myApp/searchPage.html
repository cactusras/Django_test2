{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>主頁面</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="{% static 'myApp/assets/favicon.ico' %}" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'myApp/css/styles.css' %}" rel="stylesheet" />
        <style>
            /* 初始隐藏的内容 */
            #hidden-content {
              display: none;
            }
          </style>
    </head>
    <body>
            <!--網頁頭-->
        <nav class="navbar navbar-expand-lg" style="background-color:#F0EAD6;  height: 100px;">
            <div class="container px-4 px-lg-5">
                <img src="{% static 'myApp/assets/dental.png' %}" alt="DEN Logo">
                <a class="navbar-brand" href="#!"  style="font-size: 24px;"> 牙醫預約平台</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!" style="font-size: 20px;">找醫師</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!" style="font-size: 20px;">紀錄</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!" style="font-size: 20px;">Q&A</a></li>
                    </ul>
                    <form class="d-flex">
                        <button class="btn btn-outline-dark" type="submit"  onclick="navBtn_listener(event)" id="nav_btn" style="font-size: 20px;" >
                            <i class="bi bi-person-fill"></i>
                            登入
                        </button>
                    </form>
                </div>
            </div>
        </nav>

            <!--搜尋頁面-->
        <section class="py-5"  style="background-color:#FFFFF4">
            
            <div class="container" style="border: 1px solid #F0EAD6;">
                <div class="row row-cols-2">
                    <div class="col d-flex align-items-center justify-content-center" style="background-color:#F0EAD6; border: 1px solid #ada089; height:80px; font-size: 20px; ">
                        找牙科醫師
                    </div>
                    <div class="col d-flex align-items-center justify-content-center" style="background-color:#F0EAD6; border: 1px solid #ada089; height:80px; font-size: 20px; ">
                        地圖
                    </div>
                    <!--搜尋左半部-->
                    <form method="post" id="searchForm" action="<{% url "doctor_clinic_search" %}">
                    <div class="col" style="background-color:#fffff0; border: 1px solid #ada089; height:450px; font-size: 20px;">
                        縣市地區<br>
                        <div class="row">
                            <select class="form-select" id="city" onchange="updateDistricts()" style="width: 320px; height: 40px;">
                                <option selected value="">--請選擇縣市--</option>
                                <option value="台北市">台北市</option>
                                <option value="新北市">新北市</option>
                                <option value="台中市">台中市</option>
                                <option value="台南市">台南市</option>
                                <option value="高雄市">高雄市</option>
                                <option value="基隆市">基隆市</option>
                                <option value="新竹市">新竹市</option>
                                <option value="嘉義市">嘉義市</option>
                                <option value="新竹縣">新竹縣</option>
                                <option value="苗栗縣">苗栗縣</option>
                                <option value="彰化縣">彰化縣</option>
                                <option value="南投縣">南投縣</option>
                                <option value="雲林縣">雲林縣</option>
                                <option value="嘉義縣">嘉義縣</option>
                                <option value="屏東縣">屏東縣</option>
                                <option value="宜蘭縣">宜蘭縣</option>
                                <option value="花蓮縣">花蓮縣</option>
                                <option value="台東縣">台東縣</option>
                                <option value="澎湖縣">澎湖縣</option>
                                <option value="金門縣">金門縣</option>
                                <option value="連江縣">連江縣</option>
                            </select>
                            <select class="form-select" id="district" style="width: 320px; height: 40px;">
                                <option value="">--請先選擇縣市--</option>
                            </select>
                            <input id="addressVlue" hidden>
                        </div>
                        治療項目<br>
                        <div class="row">
                            <select class="form-select" id="category" onchange="updateTreatments()" style="width: 320px; height: 40px;">
                                <option selected>--請選擇大範圍治療項目--</option>
                                <option value="預防性治療">預防性治療</option>
                                <option value="修復性治療">修復性治療</option>
                                <option value="美學治療">美學治療</option>
                                <option value="牙齒矯正">牙齒矯正</option>
                                <option value="口腔外科">口腔外科</option>
                                <option value="牙周治療">牙周治療</option>
                                <option value="兒童牙科">兒童牙科</option>
                                <option value="假牙及義齒">假牙及義齒</option>
                            </select>
                            <select class="form-select" id="treatment" style="width: 320px; height: 40px;">
                                <option value="">--請先選擇大範圍治療項目--</option>
                            </select>
                            <input id="experVlue" hidden>
                        </div>
                        看診日期<br>
                       <div>
                            <label>
                                開始：
                                <input type="date" id="inputDate" name="inputDate" min=new Date().toISOString().split('T')[0] style="width: 240px; height: 40px;"/>
                            </label>
                       </div>
                        <br>
                        <div class="form-floating">
                            <textarea class="form-control" placeholder="Leave a comment here" id="inputKeyVlue" name="inputKeyVlue"></textarea>
                            <label for="floatingTextarea" style="color:#808080">輸入醫師名稱/診所名稱/治療項目</label>
                        </div>
                        <br>
                        <br>
                        <div class="d-flex">
                            <button id="searchButton" class="btn btn-outline-dark" type="submit" style="font-size: 20px; width: 630px; height: 40px;">
                                <i class="bi bi-search"></i>
                                搜尋
                            </button>
                            
                        </div>
                    </form>
                    <!--搜尋右半部地圖-->
                    </div>
                    <div class="col" style="background-color:#fffff0; border: 1px solid #ada089; height:450px; font-size: 20px;">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3616.360365636048!2d121.57485547533233!3d24.98786804014762!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3442aa79452c2f49%3A0x9e8d07508e3bf507!2z5ZyL56uL5pS_5rK75aSn5a24!5e0!3m2!1szh-TW!2stw!4v1713968503060!5m2!1szh-TW!2stw" width="600" height="448" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </div>
        </section>

       
            <!--搜尋結果-->
            <section class="py-5 clickShow" style="background-color:#FFFFF4;">
                <div class="container px-4 px-lg-5 mt-5 clickShow" style="background-color:#FFFFF4;">
                    <h2 class="fw-bolder mb-4 clickShow">搜尋結果</h2>
            
                    <!--醫生與診所結果-->
                    <div class="container clickShow" style="border: 1px solid #FFFFF4">
                        <div class="row justify-content-evenly clickShow">
                            <!--醫生結果-->
                            <div class="col-4 clickShow" style="background-color:#fffff0; border: 1px solid #ada089; width: 550px; height:600px; font-size: 20px;">
                                <div class="h2 clickShow" style="text-align: center;">
                                    <p>醫師</p>
                                </div>
                                <figure class="figure clickShow">
                                    <img src="https://cdn-icons-png.flaticon.com/512/3845/3845316.png" class="img-thumbnail clickShow" alt="doctor" style="width: 300px; height: 300px;">
                                    <figcaption class="figure-caption clickShow">
                                        <p style="color: black;">醫師：</p>
                                        <p style="color: black;">診所：</p>
                                        <p style="color: black;">診所地址：</p>
                                        <p style="color: black;">治療項目：</p>
                                    </figcaption>
                                </figure>
                                <br> 
                                <!--預約按鈕-->
                                <div class="d-flex justify-content-center clickShow">
                                    <button class="btn btn-outline-dark" type="submit" style="font-size: 20px; width: 160px; height: 40px;" onclick="docReserve(event)">
                                        <i class="bi bi-calendar-check-fill"></i>
                                        預約此醫師
                                    </button>
                                </div>
                            </div> 
                            <!--診所結果-->
                            <div class="col-4 clickShow" style="background-color:#fffff0; border: 1px solid #ada089;width: 550px; height:600px; font-size: 20px;">
                                <div class="h2 clickShow" style="text-align: center;">
                                    <p>診所</p>
                                </div>
                                <figure class="figure clickShow">
                                    <img src="https://cdn-icons-png.flaticon.com/512/3845/3845316.png" class="img-thumbnail clickShow" alt="clinic" style="width: 300px; height: 300px;">
                                    <figcaption class="figure-caption clickShow">
                                        <p style="color: black;">診所：</p>
                                        <p style="color: black;">診所地址：</p>
                                        <p style="color: black;">簡介：</p>
                                        <p style="color: black;">治療項目：</p>
                                    </figcaption>
                                </figure>
                                <br>
                                <!--預約按鈕-->
                                <div class="d-flex justify-content-center clickShow">
                                    <button class="btn btn-outline-dark" type="submit" style="font-size: 20px; width: 160px; height: 40px;" onclick="clinReserve(event)">
                                        <i class="bi bi-calendar-check-fill"></i>
                                        預約
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--排版空格-->
                    <br>
                    <br>
                    <!--返回頁面頂部按鈕-->
                    <div class="d-flex justify-content-center clickShow">
                        <button onclick="window.scrollTo(0, 0)" class="btn" style="background-color:#F0EAD6; border: 1px solid #ada089;">返回頂部</button>
                    </div>
                </div>
            </section>
            

             <!--頁面底-->
            <footer class="py-5 bg-dark">
                <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
            </footer>
            <!-- Bootstrap core JS-->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
            <script src="{% static 'myApp/js/scripts.js' %}" ></script>
            <!-- Core theme JS-->
            <script>

                var searchClick = false;

                

                //這裡應該渲染頁面就好 其他資料會從clinic_reserve 去抓
                function docReserve(event){
                    event.preventDefault();
                    if(window.isLogin){
                        window.location.href = '/doctor/reserve';
                    }else{
                        window.location.href = '/login';
                    }
                }

                function clinReserve(event){
                    event.preventDefault();
                    if(window.isLogin){
                        window.location.href = '/clinic/reserve';
                    }else{
                        window.location.href = '/login';
                    }
                }

                var searchForm = document.getElementById('searchForm');
                searchForm.addEventListener('submit', async function(event){
                    event.preventDefault();
                    const form = {
                        doc_name: document.getElementById('docNameInput').value,
                        clinic_name: document.getElementById('clinicNameInput').value,
                        clinic_address: addrVlue;
                        appointed_date: document.getElementById('inputDate').value,
                        exp_name: experVlue;
                    };
                    fetch('/doctor/clinic/search/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(form),
                    })
                    .then(async response => {
                        if (!response.ok) {
                            throw new Error('Failed to add doctor');
                        }
                        const data = await response.json();
                        searchForm.submit();
                        window.location.href = 'searchPage.html';
                    })
                    .catch(error => {
                        // 处理错误情况，例如显示错误消息给用户
                        alert('Error adding doctor: ' + error.message);
                    });
                })

                var addrVlue = "";
                var experVlue = "";
                function updateDistricts() {
                    const cityToDistricts = {
                        '台北市': ['中正區', '大同區', '中山區', '松山區', '大安區', '萬華區', '信義區', '士林區', '北投區', '內湖區', '南港區', '文山區'],
                        '新北市': ['板橋區', '三重區', '中和區', '永和區', '新莊區', '新店區', '樹林區', '鶯歌區', '三峽區', '淡水區', '瑞芳區', '土城區', '蘆洲區', '五股區', '泰山區', '林口區', '深坑區', '石碇區', '坪林區', '三芝區', '石門區', '八里區', '平溪區', '雙溪區', '貢寮區', '金山區', '萬里區', '烏來區'],
                        '台中市': ['中區', '東區', '南區', '西區', '北區', '北屯區', '西屯區', '南屯區', '太平區', '大里區', '霧峰區', '烏日區', '豐原區', '后里區', '石岡區', '東勢區', '和平區', '新社區', '潭子區', '大雅區', '神岡區', '大肚區', '沙鹿區', '龍井區', '梧棲區', '清水區', '大甲區', '外埔區', '大安區'],
                        '台南市': ['中西區', '東區', '南區', '北區', '安平區', '安南區', '永康區', '歸仁區', '新化區', '左鎮區', '玉井區', '楠西區', '南化區', '仁德區', '關廟區', '龍崎區', '官田區', '麻豆區', '佳里區', '西港區', '七股區', '將軍區', '學甲區', '北門區', '新營區', '後壁區', '白河區', '東山區', '六甲區', '下營區', '柳營區', '鹽水區', '善化區', '大內區', '山上區', '新市區', '安定區'],
                        '高雄市': ['新興區', '前金區', '苓雅區', '鹽埕區', '鼓山區', '旗津區', '前鎮區', '三民區', '楠梓區', '小港區', '左營區', '仁武區', '大社區', '東沙群島', '南沙群島', '岡山區', '路竹區', '阿蓮區', '田寮區', '燕巢區', '橋頭區', '梓官區', '彌陀區', '永安區', '湖內區', '鳳山區', '大寮區', '林園區', '鳥松區', '大樹區', '旗山區', '美濃區', '六龜區', '內門區', '杉林區', '甲仙區', '桃源區', '那瑪夏區', '茂林區', '茄萣區'],
                        '基隆市': ['仁愛區', '信義區', '中正區', '中山區', '安樂區', '暖暖區', '七堵區'],
                        '新竹市': ['東區', '北區', '香山區'],
                        '嘉義市': ['東區', '西區'],
                        '新竹縣': ['竹北市', '湖口鄉', '新豐鄉', '新埔鎮', '關西鎮', '芎林鄉', '寶山鄉', '竹東鎮', '五峰鄉', '橫山鄉', '尖石鄉', '北埔鄉', '峨眉鄉'],
                        '苗栗縣': ['竹南鎮', '頭份市', '三灣鄉', '南庄鄉', '獅潭鄉', '後龍鎮', '通霄鎮', '苑裡鎮', '苗栗市', '造橋鄉', '頭屋鄉', '公館鄉', '大湖鄉', '泰安鄉', '銅鑼鄉', '三義鄉', '西湖鄉', '卓蘭鎮'],
                        '彰化縣': ['彰化市', '芬園鄉', '花壇鄉', '秀水鄉', '鹿港鎮', '福興鄉', '線西鄉', '和美鎮', '伸港鄉', '員林市', '社頭鄉', '永靖鄉', '埔心鄉', '溪湖鎮', '大村鄉', '埔鹽鄉', '田中鎮', '北斗鎮', '田尾鄉', '埤頭鄉', '溪州鄉', '竹塘鄉', '二林鎮', '大城鄉', '芳苑鄉', '二水鄉'],
                        '南投縣': ['南投市', '中寮鄉', '草屯鎮', '國姓鄉', '埔里鎮', '仁愛鄉', '名間鄉', '集集鎮', '水里鄉', '魚池鄉', '信義鄉', '竹山鎮', '鹿谷鄉'],
                        '雲林縣': ['斗南鎮', '大埤鄉', '虎尾鎮', '土庫鎮', '褒忠鄉', '東勢鄉', '臺西鄉', '崙背鄉', '麥寮鄉', '斗六市', '林內鄉', '古坑鄉', '莿桐鄉', '西螺鎮', '二崙鄉', '北港鎮', '水林鄉', '口湖鄉', '四湖鄉', '元長鄉'],
                        '嘉義縣': ['番路鄉', '梅山鄉', '竹崎鄉', '阿里山鄉', '中埔鄉', '大埔鄉', '水上鄉', '鹿草鄉', '太保市', '朴子市', '東石鄉', '六腳鄉', '新港鄉', '民雄鄉', '大林鎮', '溪口鄉', '義竹鄉', '布袋鎮'],
                        '屏東縣': ['屏東市', '三地門鄉', '霧臺鄉', '瑪家鄉', '九如鄉', '里港鄉', '高樹鄉', '鹽埔鄉', '長治鄉', '麟洛鄉', '竹田鄉', '內埔鄉', '萬丹鄉', '潮州鎮', '泰武鄉', '來義鄉', '萬巒鄉', '崁頂鄉', '新埤鄉', '南州鄉', '林邊鄉', '東港鎮', '琉球鄉', '佳冬鄉', '新園鄉', '枋寮鄉', '枋山鄉', '春日鄉', '獅子鄉', '車城鄉', '牡丹鄉', '恆春鎮', '滿州鄉'],
                        '宜蘭縣': ['宜蘭市', '頭城鎮', '礁溪鄉', '壯圍鄉', '員山鄉', '羅東鎮', '三星鄉', '大同鄉', '五結鄉', '冬山鄉', '蘇澳鎮', '南澳鄉', '釣魚臺'],
                        '花蓮縣': ['花蓮市', '新城鄉', '秀林鄉', '吉安鄉', '壽豐鄉', '鳳林鎮', '光復鄉', '豐濱鄉', '瑞穗鄉', '萬榮鄉', '玉里鎮', '卓溪鄉', '富里鄉'],
                        '台東縣': ['台東市', '綠島鄉', '蘭嶼鄉', '延平鄉', '卑南鄉', '鹿野鄉', '關山鎮', '海端鄉', '池上鄉', '東河鄉', '成功鎮', '長濱鄉', '太麻里鄉', '金峰鄉', '大武鄉', '達仁鄉'],
                        '澎湖縣': ['馬公市', '西嶼鄉', '望安鄉', '七美鄉', '白沙鄉', '湖西鄉'],
                        '金門縣': ['金沙鎮', '金湖鎮', '金寧鄉', '金城鎮', '烈嶼鄉', '烏坵鄉'],
                        '連江縣': ['南竿鄉', '北竿鄉', '莒光鄉', '東引鄉']
                    };
        
                    const citySelect = document.getElementById("city");
                    const districtSelect = document.getElementById("district");
                    const selectedCity = citySelect.value;
        
                    // 清空鄉鎮市區下拉選單
                    districtSelect.innerHTML = "";
        
                    // 獲取選中的縣市對應的鄉鎮市區列表
                    const districts = cityToDistricts[selectedCity];
        
                    // 添加對應的鄉鎮市區到下拉選單
                    if (districts) {
                        districts.forEach(district => {
                            const option = document.createElement("option");
                            option.value = district;
                            option.textContent = district;
                            districtSelect.appendChild(option);
                        });
                    }
                    addrVlue = updateCombinedLocation();
                }

                function updateCombinedLocation() {
                    const citySelect = document.getElementById("city");
                    const districtSelect = document.getElementById("district");
                    const address = document.getElementById("addressVlue");
                    address.value = citySelect.value + districtSelect.value;
                    return address.value;
                }

                function updateCombinedExpertise() {
                    const categorySelect = document.getElementById("category");
                    const treatmentSelect = document.getElementById("treatment");
                    const expertise = document.getElementById("experVlue");
                    expertise.value = categorySelect.value + '-' + treatmentSelect.value;
                    return expertise.value;
                }

                function updateTreatments() {
                    const categoryToTreatments = {
                        '預防性治療': ['洗牙', '塗氟', '牙齒矯正評估'],
                        '修復性治療': ['補牙', '根管治療', '牙冠修復', '牙橋'],
                        '美學治療': ['牙齒美白', '貼片', '美容冠'],
                        '牙齒矯正': ['傳統矯正', '隱形矯正', '舌側矯正'],
                        '口腔外科': ['拔牙', '智齒拔除', '牙齦手術', '植牙'],
                        '牙周治療': ['牙周病治療', '牙周手術'],
                        '兒童牙科': ['兒童補牙', '兒童矯正', '兒童預防性治療'],
                        '假牙及義齒': ['全口假牙', '局部假牙', '活動義齒', '固定義齒']
                    };

                    const categorySelect = document.getElementById("category");
                    const treatmentSelect = document.getElementById("treatment");
                    const selectedCategory = categorySelect.value;

                    // 清空具體治療項目下拉選單
                    treatmentSelect.innerHTML = "";

                    // 獲取選中的大範圍治療項目對應的具體治療項目列表
                    const treatments = categoryToTreatments[selectedCategory];

                    // 添加對應的具體治療項目到下拉選單
                    if (treatments) {
                        treatments.forEach(treatment => {
                            const option = document.createElement("option");
                            option.value = treatment;
                            option.textContent = treatment;
                            treatmentSelect.appendChild(option);
                        });
                    }
                    experVlue = updateCombinedExpertise();
                }

            </script>
          
           
            
            
    </body>
</html>