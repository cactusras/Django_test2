{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>主頁面</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="{% static 'myApp/assets/favicon.ico' %}" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'myApp/css/styles.css' %}" rel="stylesheet" />
        <style>
            /* 初始隐藏的内容 */
            #hidden-content {
              display: none;
            }
          </style>

          <style>
            #resultsContainer {
                margin-top: 20px;
            }
            .doctor, .clinic {
                border: 1px solid #ccc;
                padding: 10px;
                margin-bottom: 10px;
            }
            h3 {
                margin: 0 0 10px;
                cursor: pointer; /* 添加鼠标指针样式 */
                color: blue; /* 添加链接颜色 */
                text-decoration: underline; /* 添加下划线 */
            }
        </style>
    </head>
    <body>
            <!--網頁頭-->
        <nav class="navbar navbar-expand-lg" style="background-color:#F0EAD6;  height: 100px;">
            <div class="container px-4 px-lg-5">
                <img src="{% static 'myApp/assets/dental.png' %}" alt="DEN Logo">
                <a class="navbar-brand" href="#!"  style="font-size: 24px;"> 牙醫預約平台</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!" style="font-size: 20px;">找醫師</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!" style="font-size: 20px;">紀錄</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!" style="font-size: 20px;">Q&A</a></li>
                    </ul>
                    <form class="d-flex">
                        <button class="btn btn-outline-dark" type="submit"  style="font-size: 20px;" id = 'nav_btn' onclick='navBtn_listener(event)'>
                            <i class="bi bi-person-fill"></i>
                            登入
                        </button>
                    </form>
                </div>
            </div>
        </nav>

            <!--搜尋頁面-->
            <section class="py-5" style="background-color:#FFFFF4">
                <div class="col" style="background-color:#fffff0; border: 1px solid #ada089; height:450px; font-size: 20px;">
                    <form id="searchForm" method='post' action="/doctor/clinic/search/">
                        {% csrf_token %}
                        <br> 縣市地區<br>
                        <div class="row">
                            <select class="form-select" id="city" onchange="updateDistricts()" style="width: 320px; height: 40px;">
                                <option selected value="">--請選擇縣市--</option>

                                <!-- Add your options here -->
                            </select>
                            <select class="form-select" id="district" style="width: 320px; height: 40px;">
                                <option value="">--請先選擇縣市--</option>
                            </select>
                        </div>
                        治療項目<br>
                        <div class="row">
                            <select class="form-select" id="category" onchange="updateTreatments()" style="width: 320px; height: 40px;">
                                <option selected>--請選擇大範圍治療項目--</option>
                                <!-- Add your options here -->
                            </select>
                            <select class="form-select" id="treatment" style="width: 320px; height: 40px;">
                                <option value="">--請先選擇大範圍治療項目--</option>
                            </select>
                        </div>
                        看診日期<br>
                        <div>
                            <label>
                                開始：
                                <input type="date" id="startDate" name="startDate" style="width: 240px; height: 40px;"/>
                            </label>
                            <label>
                                結束：
                                <input type="date" id="endDate" name="endDate" style="width: 250px; height: 40px;"/>
                            </label>
                        </div> 
                        <br>查詢欄位<br>
                        <div>
                            <label for="query">Query:</label>
                            <input type="text" id="query" name="query" style="width: 320px; height: 40px;">
                        </div>
                        <br>
                        <div>
                            {% comment %} <label for="search">Search:</label>
                            <input type="text" id="search" name="search"> {% endcomment %}

                            <button type="submit">Search</button>
                        </div>
                    </form>
                
            </section>
        
            <!--搜尋結果-->
            <section class="py-5" style="background-color:#FFFFF4;">
                <div class="container px-4 px-lg-5 mt-5" style="background-color:#FFFFF4;">
                    <h2 class="fw-bolder mb-4">搜尋結果</h2>
                    <div id="resultsContainer">
                        <!-- 搜索结果会显示在这里 -->
                    </div>

                    

                    <div class="container" style="border: 1px solid #FFFFF4">
                        <div class="row justify-content-evenly">
                            <!--醫生結果-->
                            <div class="col-4" style="background-color:#fffff0; border: 1px solid #ada089; width: 550px; height:600px; font-size: 20px;">
                                <div class="h2" style="text-align: center;">
                                    <p>醫師</p>
                                </div>
                                <figure class="figure">
                                    <div id="doctors">
                                        <h2>Doctors</h2>
                                        <ul id="doctor-list"></ul>
                                    </div>
                                    <img src="https://cdn-icons-png.flaticon.com/512/3845/3845316.png" class="img-thumbnail" alt="doctor" style="width: 300px; height: 300px;">
                                    <figcaption class="figure-caption">
                                        <p style="color: black;">醫師：</p>
                                        <p style="color: black;">診所：</p>
                                        <p style="color: black;">診所地址：</p>
                                        <p style="color: black;">治療項目：</p>
                                    </figcaption>
                                </figure>
                                <br>
                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-outline-dark" type="submit" style="font-size: 20px; width: 160px; height: 40px;" onclick="docReserve(event)">
                                        <i class="bi bi-calendar-check-fill"></i> 預約此醫師
                                    </button>
                                </div>
                            </div>
                            <!--診所結果-->
                            <div class="col-4" style="background-color:#fffff0; border: 1px solid #ada089;width: 550px; height:600px; font-size: 20px;">
                                <div class="h2" style="text-align: center;">
                                    <p>診所</p>
                                </div>
                                <figure class="figure">
                                    <div id="clinics">
                                        <h2>Clinics</h2>
                                        <ul id="clinic-list"></ul>
                                    </div>
                                    <img src="https://cdn-icons-png.flaticon.com/512/4315/4315445.png" class="img-thumbnail" alt="clinic" style="width: 300px; height: 300px;">
                                    <figcaption class="figure-caption">
                                        <p style="color: black;">診所：</p>
                                        <p style="color: black;">診所地址：</p>
                                        <p style="color: black;">診所電話：</p>
                                        <p style="color: black;">治療項目：</p>
                                    </figcaption>
                                </figure>
                                <br>
                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-outline-dark" type="submit" style="font-size: 20px; width: 160px; height: 40px;" onclick="cliReserve(event)">
                                        <i class="bi bi-calendar-check-fill"></i> 預約此診所
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        

             <!--頁面底-->
            <footer class="py-5 bg-dark">
                <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
            </footer>
            <!-- Bootstrap core JS-->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
            <script src="{% static 'myApp/js/scripts.js' %}" ></script>
            <!-- Core theme JS-->
            <script>

                function search(event) {
                    event.preventDefault();  // 阻止默认的表单提交行为
                
                    // 获取表单数据
                    const form = document.getElementById('searchForm');
                    const formData = new FormData(form);
                
                    // 发送 POST 请求
                    fetch('/doctor/clinic/search/', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 处理从后端返回的 JSON 数据
                        console.log(data);  // 可以在控制台查看数据，根据需要进行处理
                        const resultsContainer = document.getElementById('resultsContainer');
                        resultsContainer.innerHTML = '';

                        if (data.doctors.length > 0) {
                            const doctorTitle = document.createElement('h2');
                            doctorTitle.textContent = 'Doctors';
                            resultsContainer.appendChild(doctorTitle);
                
                            data.doctors.forEach(doctor => {
                                const doctorDiv = document.createElement('div');
                                doctorDiv.classList.add('doctor');
                                doctorDiv.innerHTML = `
                                    <h3 class="doctor-name" data-doc-id="${doctor.doc_id}">${doctor.doc_name}</h3>
                                    <p><strong>Clinic:</strong> ${doctor.clinic_name}</p>
                                    <p><strong>Address:</strong> ${doctor.clinic_address}</p>
                                    <p><strong>Expertise:</strong> ${doctor.doc_exp.join(', ')}</p>
                                `;
                                resultsContainer.appendChild(doctorDiv);
                            });

                            document.querySelectorAll('.doctor-name').forEach(element => {
                                element.addEventListener('click', function() {
                                    const docId = this.dataset.docId;
                                    window.location.href = `/doctor/reserve/${docId}/`;
                                });
                            });
                        }
                
                        if (data.clinics.length > 0) {
                            const clinicTitle = document.createElement('h2');
                            clinicTitle.textContent = 'Clinics';
                            resultsContainer.appendChild(clinicTitle);
                        
                            data.clinics.forEach(clinic => {
                                const clinicDiv = document.createElement('div');
                                clinicDiv.classList.add('clinic');
                                
                                clinicDiv.innerHTML = `
                                    <h3 class="clinic-name" data-clinic-id="${clinic.clinic_id}">${clinic.clinic_name}</h3>
                                    <p><strong>Address:</strong> ${clinic.clinic_address}</p>
                                    <p><strong>Introduction:</strong> ${clinic.clinic_introduction}</p>
                                    <p><strong>Expertise:</strong> ${clinic.doc_exp.join(', ')}</p>
                                `;
                                
                                resultsContainer.appendChild(clinicDiv);
                            });
                        
                            // 确保事件监听器绑定在元素添加到文档后
                            document.querySelectorAll('.clinic-name').forEach(element => {
                                element.addEventListener('click', function() {
                                    const clinic_id = this.getAttribute('data-clinic-id');
                                    console.log(clinic_id);  // 确认可以获取到clinic_id
                                    window.location.href = `clinic/reserve/${clinic_id}/`;
                                });
                            });
                        }

                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });
                }
                
                // 监听表单的 submit 事件，并调用 search 函数
                const searchForm = document.getElementById('searchForm');
                searchForm.addEventListener('submit', search);



                //這裡應該渲染頁面就好 其他資料會從clinic_reserve 去抓
                // {% comment %} function docReserve(docId){
                //     %event.preventDefault();
                //     if(window.isLogin){
                //         window.location.href = '/doctor/reserve';
                //     }else{
                //         window.location.href = 'login';
                //     }
                // } {% endcomment %}

                // {% comment %} function clinReserve(event){
                //     event.preventDefault();
                //     if(window.isLogin){
                //         window.location.href = '/clinic/reserve';
                //     }else{
                //         window.location.href = 'login';
                //     }
                // } {{ endcomment }}

                function updateDistricts() {
                    const cityToDistricts = {
                        '台北市': ['中正區', '大同區', '中山區', '松山區', '大安區', '萬華區', '信義區', '士林區', '北投區', '內湖區', '南港區', '文山區'],
                        '新北市': ['板橋區', '三重區', '中和區', '永和區', '新莊區', '新店區', '樹林區', '鶯歌區', '三峽區', '淡水區', '瑞芳區', '土城區', '蘆洲區', '五股區', '泰山區', '林口區', '深坑區', '石碇區', '坪林區', '三芝區', '石門區', '八里區', '平溪區', '雙溪區', '貢寮區', '金山區', '萬里區', '烏來區'],
                        '台中市': ['中區', '東區', '南區', '西區', '北區', '北屯區', '西屯區', '南屯區', '太平區', '大里區', '霧峰區', '烏日區', '豐原區', '后里區', '石岡區', '東勢區', '和平區', '新社區', '潭子區', '大雅區', '神岡區', '大肚區', '沙鹿區', '龍井區', '梧棲區', '清水區', '大甲區', '外埔區', '大安區'],
                        '台南市': ['中西區', '東區', '南區', '北區', '安平區', '安南區', '永康區', '歸仁區', '新化區', '左鎮區', '玉井區', '楠西區', '南化區', '仁德區', '關廟區', '龍崎區', '官田區', '麻豆區', '佳里區', '西港區', '七股區', '將軍區', '學甲區', '北門區', '新營區', '後壁區', '白河區', '東山區', '六甲區', '下營區', '柳營區', '鹽水區', '善化區', '大內區', '山上區', '新市區', '安定區'],
                        '高雄市': ['新興區', '前金區', '苓雅區', '鹽埕區', '鼓山區', '旗津區', '前鎮區', '三民區', '楠梓區', '小港區', '左營區', '仁武區', '大社區', '東沙群島', '南沙群島', '岡山區', '路竹區', '阿蓮區', '田寮區', '燕巢區', '橋頭區', '梓官區', '彌陀區', '永安區', '湖內區', '鳳山區', '大寮區', '林園區', '鳥松區', '大樹區', '旗山區', '美濃區', '六龜區', '內門區', '杉林區', '甲仙區', '桃源區', '那瑪夏區', '茂林區', '茄萣區'],
                        '基隆市': ['仁愛區', '信義區', '中正區', '中山區', '安樂區', '暖暖區', '七堵區'],
                        '新竹市': ['東區', '北區', '香山區'],
                        '嘉義市': ['東區', '西區'],
                        '新竹縣': ['竹北市', '湖口鄉', '新豐鄉', '新埔鎮', '關西鎮', '芎林鄉', '寶山鄉', '竹東鎮', '五峰鄉', '橫山鄉', '尖石鄉', '北埔鄉', '峨眉鄉'],
                        '苗栗縣': ['竹南鎮', '頭份市', '三灣鄉', '南庄鄉', '獅潭鄉', '後龍鎮', '通霄鎮', '苑裡鎮', '苗栗市', '造橋鄉', '頭屋鄉', '公館鄉', '大湖鄉', '泰安鄉', '銅鑼鄉', '三義鄉', '西湖鄉', '卓蘭鎮'],
                        '彰化縣': ['彰化市', '芬園鄉', '花壇鄉', '秀水鄉', '鹿港鎮', '福興鄉', '線西鄉', '和美鎮', '伸港鄉', '員林市', '社頭鄉', '永靖鄉', '埔心鄉', '溪湖鎮', '大村鄉', '埔鹽鄉', '田中鎮', '北斗鎮', '田尾鄉', '埤頭鄉', '溪州鄉', '竹塘鄉', '二林鎮', '大城鄉', '芳苑鄉', '二水鄉'],
                        '南投縣': ['南投市', '中寮鄉', '草屯鎮', '國姓鄉', '埔里鎮', '仁愛鄉', '名間鄉', '集集鎮', '水里鄉', '魚池鄉', '信義鄉', '竹山鎮', '鹿谷鄉'],
                        '雲林縣': ['斗南鎮', '大埤鄉', '虎尾鎮', '土庫鎮', '褒忠鄉', '東勢鄉', '臺西鄉', '崙背鄉', '麥寮鄉', '斗六市', '林內鄉', '古坑鄉', '莿桐鄉', '西螺鎮', '二崙鄉', '北港鎮', '水林鄉', '口湖鄉', '四湖鄉', '元長鄉'],
                        '嘉義縣': ['番路鄉', '梅山鄉', '竹崎鄉', '阿里山鄉', '中埔鄉', '大埔鄉', '水上鄉', '鹿草鄉', '太保市', '朴子市', '東石鄉', '六腳鄉', '新港鄉', '民雄鄉', '大林鎮', '溪口鄉', '義竹鄉', '布袋鎮'],
                        '屏東縣': ['屏東市', '三地門鄉', '霧臺鄉', '瑪家鄉', '九如鄉', '里港鄉', '高樹鄉', '鹽埔鄉', '長治鄉', '麟洛鄉', '竹田鄉', '內埔鄉', '萬丹鄉', '潮州鎮', '泰武鄉', '來義鄉', '萬巒鄉', '崁頂鄉', '新埤鄉', '南州鄉', '林邊鄉', '東港鎮', '琉球鄉', '佳冬鄉', '新園鄉', '枋寮鄉', '枋山鄉', '春日鄉', '獅子鄉', '車城鄉', '牡丹鄉', '恆春鎮', '滿州鄉'],
                        '宜蘭縣': ['宜蘭市', '頭城鎮', '礁溪鄉', '壯圍鄉', '員山鄉', '羅東鎮', '三星鄉', '大同鄉', '五結鄉', '冬山鄉', '蘇澳鎮', '南澳鄉', '釣魚臺'],
                        '花蓮縣': ['花蓮市', '新城鄉', '秀林鄉', '吉安鄉', '壽豐鄉', '鳳林鎮', '光復鄉', '豐濱鄉', '瑞穗鄉', '萬榮鄉', '玉里鎮', '卓溪鄉', '富里鄉'],
                        '台東縣': ['台東市', '綠島鄉', '蘭嶼鄉', '延平鄉', '卑南鄉', '鹿野鄉', '關山鎮', '海端鄉', '池上鄉', '東河鄉', '成功鎮', '長濱鄉', '太麻里鄉', '金峰鄉', '大武鄉', '達仁鄉'],
                        '澎湖縣': ['馬公市', '西嶼鄉', '望安鄉', '七美鄉', '白沙鄉', '湖西鄉'],
                        '金門縣': ['金沙鎮', '金湖鎮', '金寧鄉', '金城鎮', '烈嶼鄉', '烏坵鄉'],
                        '連江縣': ['南竿鄉', '北竿鄉', '莒光鄉', '東引鄉']
                    };
        
                    const citySelect = document.getElementById("city");
                    const districtSelect = document.getElementById("district");
                    const selectedCity = citySelect.value;
        
                    // 清空鄉鎮市區下拉選單
                    districtSelect.innerHTML = "";
        
                    // 獲取選中的縣市對應的鄉鎮市區列表
                    const districts = cityToDistricts[selectedCity];
        
                    // 添加對應的鄉鎮市區到下拉選單
                    if (districts) {
                        districts.forEach(district => {
                            const option = document.createElement("option");
                            option.value = district;
                            option.textContent = district;
                            districtSelect.appendChild(option);
                        });
                    }
                    updateCombinedLocation();
                }

                function updateCombinedLocation() {
                    const citySelect = document.getElementById("city");
                    const districtSelect = document.getElementById("district");
                    const address = document.getElementById("addressVlue");
                    address.value = citySelect.value + districtSelect.value;
                }

                function updateCombinedExpertise() {
                    const categorySelect = document.getElementById("category");
                    const treatmentSelect = document.getElementById("treatment");
                    const expertise = document.getElementById("experVlue");
                    expertise.value = categorySelect.value + '-' + treatmentSelect.value;
                }

                function updateTreatments() {
                    const categoryToTreatments = {
                        '預防性治療': ['洗牙', '塗氟', '牙齒矯正評估'],
                        '修復性治療': ['補牙', '根管治療', '牙冠修復', '牙橋'],
                        '美學治療': ['牙齒美白', '貼片', '美容冠'],
                        '牙齒矯正': ['傳統矯正', '隱形矯正', '舌側矯正'],
                        '口腔外科': ['拔牙', '智齒拔除', '牙齦手術', '植牙'],
                        '牙周治療': ['牙周病治療', '牙周手術'],
                        '兒童牙科': ['兒童補牙', '兒童矯正', '兒童預防性治療'],
                        '假牙及義齒': ['全口假牙', '局部假牙', '活動義齒', '固定義齒']
                    };

                    const categorySelect = document.getElementById("category");
                    const treatmentSelect = document.getElementById("treatment");
                    const selectedCategory = categorySelect.value;

                    // 清空具體治療項目下拉選單
                    treatmentSelect.innerHTML = "";

                    // 獲取選中的大範圍治療項目對應的具體治療項目列表
                    const treatments = categoryToTreatments[selectedCategory];

                    // 添加對應的具體治療項目到下拉選單
                    if (treatments) {
                        treatments.forEach(treatment => {
                            const option = document.createElement("option");
                            option.value = treatment;
                            option.textContent = treatment;
                            treatmentSelect.appendChild(option);
                        });
                    }
                    updateCombinedExpertise();
                }

            </script>

            <script>
                // {% comment %} gpt生成的，如果還有要顯示的條件在這裡加一加就好 {% endcomment %}
                
            </script>
        
          
           
            
            
    </body>
</html>